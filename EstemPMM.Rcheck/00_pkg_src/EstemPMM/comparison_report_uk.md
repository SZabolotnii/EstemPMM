# Порівняльний аналіз підходів PMM2 для оцінювання параметрів

## 1. Вступ
Цей звіт містить порівняльний аналіз двох підходів до використання методу максимізації полінома (PMM2) для оцінювання параметрів регресійних моделей з негаусовими помилками, зокрема в контексті часових рядів SARIMA. Аналіз базується на результатах останніх покращень у пакеті `EstemPMM` та підході, викладеному в статті *"Application of the Polynomial Maximization Method for Estimating Nonlinear Regression Parameters with Non-gaussian Asymmetric Errors"*.

## 2. Опис підходів

### Підхід А: Лінеаризований Мультиплікативний PMM2 (Поточне покращення)
Цей підхід був реалізований для вирішення проблеми ефективності оцінювання змішаних MA+SMA моделей.

*   **Суть методу**: Використовує ітеративну процедуру, властиву класичному PMM2, але адаптує її до нелінійної природи мультиплікативних моделей SARIMA через лінеаризацію.
*   **Ключова інновація**: Явне розширення матриці плану (Design Matrix) стовпцями, що відповідають членам взаємодії (наприклад, $\theta \Theta \epsilon_{t-s-1}$).
*   **Механізм оцінювання**:
    1.  Модель лінеаризується навколо поточних значень параметрів (розкладання в ряд Тейлора).
    2.  Створюється розширена матриця регресорів, що включає градієнти по основних параметрах та членах взаємодії.
    3.  Застосовується стандартний алгоритм PMM2 (розв'язання системи лінійних рівнянь з вагами, що залежать від моментів вищих порядків) для оновлення параметрів.
    4.  Коефіцієнти взаємодії оцінюються вільно, що дозволяє врахувати мультиплікативну структуру без жорстких обмежень на кожному кроці.

### Підхід Б: Нелінійний PMM2 (Підхід зі статті)
Цей підхід базується на прямій оптимізації критерію PMM2 для нелінійних моделей, як описано в досліджуваній статті та реалізовано в `new_sarima/experimental/05_nonlinear_pmm2_for_ma.R`.

*   **Суть методу**: Розглядає задачу як задачу нелінійної оптимізації загального вигляду.
*   **Цільова функція**: Максимізація критерію PMM2:
    $$J(\theta) = \frac{\gamma_3(\epsilon(\theta))^2}{2 + \gamma_4(\epsilon(\theta))}$$
    де $\gamma_3$ та $\gamma_4$ — асиметрія та ексцес (kurtosis) залишків моделі, які перераховуються для кожного значення $\theta$.
*   **Механізм оцінювання**:
    1.  Для заданого вектора параметрів $\theta$ рекурсивно обчислюються інновації (залишки) $\epsilon_t(\theta)$.
    2.  Обчислюються вибіркові моменти (skewness, kurtosis) цих залишків.
    3.  Використовується чисельний оптимізатор (наприклад, BFGS, Nelder-Mead або L-BFGS-B) для пошуку $\theta$, що максимізує $J(\theta)$.
    4.  Не вимагає явного виведення матриці плану або лінеаризації моделі вручну — це робиться неявно чисельним методом.

## 3. Порівняльний аналіз

| Характеристика | Лінеаризований Мультиплікативний PMM2 (Підхід А) | Нелінійний PMM2 (Підхід Б) |
| :--- | :--- | :--- |
| **Математична основа** | Ітеративне розв'язання лінеаризованої системи (аналог IRLS/Newton-Raphson на рівні алгоритму PMM). | Пряма чисельна оптимізація (Direct Numerical Optimization) цільової функції. |
| **Врахування структури** | **Явне**: Спеціально побудована матриця плану з членами взаємодії для SARIMA. | **Неявне**: Через рекурсивне обчислення залишків $\epsilon_t(\theta)$. |
| **Обчислювальна складність** | Зазвичай нижча. Вимагає менше ітерацій, оскільки використовує аналітичні властивості PMM. | Зазвичай вища. Чисельна оптимізація може потребувати багато викликів функції для обчислення градієнтів. |
| **Стабільність** | Висока, за умови гарної ініціалізації. "Вільна" оцінка взаємодій додає гнучкості. | Залежить від оптимізатора. Може застрягати в локальних екстремумах або бути чутливим до початкових точок. |
| **Універсальність** | Потребує адаптації матриці плану для кожного нового класу моделей (наприклад, додавання нових стовпців для SARIMA). | Висока. Можна застосувати до будь-якої моделі, для якої можна обчислити залишки (функцію `compute_innovations`). |
| **Ефективність (MSE)** | **Висока**. Звіт показує перевагу над MLE навіть на малих вибірках (n=100) завдяки точному врахуванню структури. | Потенційно висока, але залежить від точності знаходження глобального максимуму складної нелінійної поверхні. |

## 4. Висновки та рекомендації

1.  **Перевага Лінеаризованого підходу для SARIMA**: Результати розслідування чітко вказують, що для специфічної задачі оцінювання параметрів SARIMA (де є чітка мультиплікативна структура), **Підхід А (Лінеаризований Мультиплікативний PMM2)** є кращим. Він забезпечує стабільність та високу ефективність, явно моделюючи взаємодію параметрів через розширену матрицю плану.
2.  **Роль Нелінійного підходу**: Підхід Б (зі статті) є цінним як **універсальний метод** для моделей, де важко вивести лінеаризовану форму або побудувати матрицю плану. Він може слугувати гарним інструментом для перевірки або як запасний варіант (fallback), але для продуктивного використання в пакеті `EstemPMM` для стандартних моделей SARIMA лінеаризований підхід виглядає більш надійним та швидким.
3.  **Стратегія розвитку**: Рекомендується залишити Лінеаризований Мультиплікативний PMM2 як основний алгоритм для `sarima_pmm2`, оскільки він вже показав здатність перевершувати MLE. Нелінійний підхід можна зберегти в експериментальній гілці для складніших нелінійних моделей, що не вписуються в структуру SARIMA.
